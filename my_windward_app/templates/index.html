{% extends "base.html" %}

{% block title %}Login{% endblock %}

{% block content %}

        <h1>Login</h1>
        <form id="login-form">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="remember" name="remember">
                <label for="remember">Remember Me</label>
            </div>
            <button type="submit">Login</button>
        </form>
        <div id="message"></div>
        <p><a href="/auth/register">Don't have an account? Register here.</a></p>
    
    <script>
        // get references to the form and the message display area
        const loginForm = document.getElementById('login-form');
        const messageDiv = document.getElementById('message');

        // add an event listener for the form's 'submit' event
        loginForm.addEventListener('submit', async (event) => {
            // prevent the default form submission which refreshes the page
            event.preventDefault();

            // create a data object from the form fields
            const formData = new FormData(loginForm);
            const data = Object.fromEntries(formData.entries());

            // send the username/password to our /auth/login API endpoint
            const response = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                // if the response was successful (status 200-299), redirect to the profile page
                window.location.href = '/api/profile/';
            } else {
                messageDiv.textContent = result.error;
                messageDiv.style.color = 'red';
            }
        });
    </script>
{% endblock %}