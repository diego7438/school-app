{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="dashboard-container">
    <header style= "margin-bottom: 40px; border-bottom: 1px solid #30363d; padding-bottom: 20px;">
        <h1>Welcome, {{ g.user['username'] }}!</h1>
        <p style= "color: #8b949e;">Role: <span style= "text-transform: capitalize; color: #58a6ff;">{{ g.user['role'] }}</span></p>
        <button id="logout-button" style="background-color: #21262d; color: #c9d1d9; border: 1px solid #30363d; padding: 5px 10px; border-radius: 6px; cursor: pointer;">Logout</button>
    </header>

    <div class="grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <!-- Schedule Card -->
         <div class="card" style="background-color: #161b22; padding: 20px; border-radius: 6px; border: 1px solid #30363d;">
            <h3 style="margin-top: 0;">ğŸ“… Today's Schedule</h3>
            {% if rotation %}

                <p style="font-size: 1.5em; font-weight: bold; color: #58a6ff; margin: 10px 0;">
                    Rotation {{ rotation[0] }}
                </p>

                <p style="color: #8b949e; margin-top: 5px;">
                    {{ date.strftime('%A, %B %d') }}
                </p>

            {% else %}
                <p style="color: #8b949e; font-size: 1.1em; margin: 10px 0;">No School Today ğŸ–ï¸</p>
                <p style="font-size: 0.9em; color: #6e7681;">
                    {{ date.strftime('%A, %B %d') }}
                </p>
            {% endif %}
         </div>

         <!-- Announcements Card -->
          <div class="card" style="background-color: #161b22; padding: 20px; border-radius: 6px; border: 1px solid #30363d;">
            <h3 style="margin-top: 0;">ğŸ“¢ Announcements</h3>
            <p>No new announcements.</p>
          </div>

         <!-- AI Chat Card -->
         <div class="card" style="background-color: #161b22; padding: 20px; border-radius: 6px; border: 1px solid #30363d;">
            <h3 style="margin-top: 0;">ğŸ¤– AI Assistant</h3>
            <p style="color: #8b949e;">Ask questions about the schedule.</p>
            <a href="/chat/" class="cta-button" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background-color: #238636; color: white; text-decoration: none; border-radius: 6px;">Open Chat</a>
         </div>

         <!-- Calendar Card -->
         <div class="card" style="background-color: #161b22; padding: 20px; border-radius: 6px; border: 1px solid #30363d;">
            <h3 style="margin-top: 0;">ğŸ“… Check Dates</h3>
            <p style="color: #8b949e;">Look up the rotation for any date.</p>
            <a href="/api/rotation/" class="cta-button" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background-color: #1f6feb; color: white; text-decoration: none; border-radius: 6px;">View Calendar</a>
         </div>
    </div>
</div>

<script>
    const logoutButton = document.getElementById('logout-button');
    if (logoutButton) {
        logoutButton.addEventListener('click', async () => {
            const response = await fetch('/auth/logout', {
                method: 'POST'
            });
            if (response.ok) {
                window.location.href = '/auth/login';
            }
        });
    }
</script>
{% endblock %}